DROP VIEW V_FACT_MEMBER_MONTH_RISK;

CREATE OR REPLACE VIEW V_FACT_MEMBER_MONTH_RISK
(
    DATA_SOURCE,
    MRN,
    MONTH_ID,
    PROGRAM,
    BOROUGH,
    COUNTY_CODE,
    STAFF_ID,
    MEDICAID_NUM,
    MEDICARE_NUM,
    SUBSCRIBER_ID,
    BENEFIT_REGION,
    UAS_DATE,
    UAS_NFLOC_SCORE,
    DC_REASON,
    DISENROLL_DISP,
    FLAG,
    CASE_NBR,
    STATE_CODE,
    ENROLLMENT_DATE,
    DISENROLLMENT_DATE,
    ENROLLED_FLAG,
    DISENROLLED_FLAG,
    LINE_OF_BUSINESS,
    PROVIDER_ID,
    PROVIDER_NAME,
    MONTH,
    SSN,
    LAST_NAME,
    FIRST_NAME,
    DATE_OF_BIRTH,
    AGE,
    SEX,
    COUNTY,
    HIGHEST_CASE_NUMBER,
    LOB_ID,
    UAS_RECORD_ID,
    REFERRAL_DATE,
    MANDATORY_ENROLLMENT,
    DISENROLL_RSN_DESC,
    PRODUCT_ID,
    PRODUCT_NAME,
    PLAN_ID,
    PLAN_DESC,
    REGION_NAME,
    REGION_NAME2,
    DL_MEMBER_SK,
    MEMBER_ID,
    DL_PMPM_ENR_SK,
    DL_ENROLL_ID,
    DL_ENRL_SK,
    DL_LOB_ID,
    DL_PLAN_SK,
    DL_PROV_SK,
    CM_SK_ID,
    DL_ASSESS_SK,
    DL_LOB_GRP_ID,
    DL_MEMBER_ADDRESS_SK,
    DL_COUNTY_SK,
    DL_JOB_RUN_ID,
    DL_CRT_TS,
    DL_UPD_TS,
    RATE_CODE,
    RATE_CODE_DESC,
    REPORTING_DATE,
    SUBJ90RULE_IND,
    PRVDR_SRC_SYS,
    CRTE_USR_ID,
    CRTE_TS,
    UPDT_USR_ID,
    UPDT_TS,
    PLAN_PACKAGE,
    RISK_GROUP,
    RISK_SCORE
) AS
    SELECT A."DATA_SOURCE",
           A."MRN",
           A."MONTH_ID",
           A."PROGRAM",
           A."BOROUGH",
           A."COUNTY_CODE",
           A."STAFF_ID",
           A."MEDICAID_NUM",
           A."MEDICARE_NUM",
           A."SUBSCRIBER_ID",
           A."BENEFIT_REGION",
           A."UAS_DATE",
           A."UAS_NFLOC_SCORE",
           A."DC_REASON",
           A."DISENROLL_DISP",
           A."FLAG",
           A."CASE_NBR",
           A."STATE_CODE",
           A."ENROLLMENT_DATE",
           A."DISENROLLMENT_DATE",
           A."ENROLLED_FLAG",
           A."DISENROLLED_FLAG",
           A."LINE_OF_BUSINESS",
           A."PROVIDER_ID",
           A."PROVIDER_NAME",
           A."MONTH",
           A."SSN",
           A."LAST_NAME",
           A."FIRST_NAME",
           A."DATE_OF_BIRTH",
           A."AGE",
           A."SEX",
           A."COUNTY",
           A."HIGHEST_CASE_NUMBER",
           A."LOB_ID",
           A."UAS_RECORD_ID",
           A."REFERRAL_DATE",
           A."MANDATORY_ENROLLMENT",
           A."DISENROLL_RSN_DESC",
           A."PRODUCT_ID",
           A."PRODUCT_NAME",
           A."PLAN_ID",
           A."PLAN_DESC",
           A."REGION_NAME",
           A."REGION_NAME2",
           A."DL_MEMBER_SK",
           A."MEMBER_ID",
           A."DL_PMPM_ENR_SK",
           A."DL_ENROLL_ID",
           A."DL_ENRL_SK",
           A."DL_LOB_ID",
           A."DL_PLAN_SK",
           A."DL_PROV_SK",
           A."CM_SK_ID",
           A."DL_ASSESS_SK",
           A."DL_LOB_GRP_ID",
           A."DL_MEMBER_ADDRESS_SK",
           A."DL_COUNTY_SK",
           A."DL_JOB_RUN_ID",
           A."DL_CRT_TS",
           A."DL_UPD_TS",
           A."RATE_CODE",
           A."RATE_CODE_DESC",
           A."REPORTING_DATE",
           A."SUBJ90RULE_IND",
           A."PRVDR_SRC_SYS",
           A."CRTE_USR_ID",
           A."CRTE_TS",
           A."UPDT_USR_ID",
           A."UPDT_TS",
           A."PLAN_PACKAGE",
           B.RISK_GROUP,
           B.RISK_SCORE
    FROM   FACT_MEMBER_MONTH A
           LEFT OUTER JOIN (SELECT *
                            FROM   V_UAS_RISK_SCORE
                            WHERE  MERCER_DOC_YEAR = (SELECT MAX(MERCER_DOC_YEAR) FROM UAS_RISK_SCORE)) B
               ON (A.UAS_RECORD_ID = B.RECORD_ID);


GRANT SELECT ON V_FACT_MEMBER_MONTH_RISK TO MICHAEL_K;
